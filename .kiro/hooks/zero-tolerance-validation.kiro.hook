{
  "enabled": true,
  "name": "Zero Tolerance Validation",
  "description": "Enforces context-aware validation: TypeScript checks for .ts/.tsx, lint checks for code files, full validation for task/phase completion",
  "version": "2.0",
  "documentation": {
    "purpose": "This hook ensures code quality by enforcing validation after write operations, with smart detection of file types and validation scope. It prevents technical debt accumulation by catching errors immediately rather than deferring them.",
    "whyPostToolUse": "postToolUse is used instead of preToolUse because validation must occur AFTER the write completes. preToolUse would block the write operation itself, preventing the agent from making any changes. postToolUse allows the write to complete, then immediately validates the result.",
    "whyAskAgent": "askAgent is used instead of runCommand because the validation workflow requires intelligent decision-making. The agent must analyze errors, determine fix order (TypeScript → lint → tests), and iterate until zero errors. A simple runCommand cannot handle this complexity or make contextual decisions about how to fix errors.",
    "designRationale": "The validation process is now context-aware to improve efficiency. File-level changes trigger targeted checks (TypeScript for .ts/.tsx, lint for code files), while task/phase completion triggers full validation. This reduces unnecessary test runs while maintaining zero-tolerance standards.",
    "validationLevels": {
      "fileLevel": "Triggered by individual file writes. Runs targeted checks based on file extension.",
      "taskLevel": "Triggered when a main task (with subtasks) is marked complete. Runs full validation.",
      "phaseLevel": "Triggered when all tasks in a phase are complete. Runs full validation."
    }
  },
  "when": {
    "type": "postToolUse",
    "toolTypes": [
      "write"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "A write operation just completed. Apply the TDD-Aware Context-Aware Zero Tolerance Validation workflow:\n\n**STEP 0: Detect TDD Phase**\n\nFirst, determine if we're in TDD RED phase (tests expected to fail) or GREEN phase (tests must pass):\n\n**RED PHASE Indicators (tests SHOULD fail - skip test validation):**\n- Test file (*.test.ts, *.test.tsx) was just created/modified\n- AND corresponding implementation file does NOT exist yet\n- Example: Created `src/types/plugin.test.ts` but `src/types/plugin.ts` doesn't exist\n\n**GREEN PHASE Indicators (tests MUST pass - run full validation):**\n- Implementation file was just created/modified AND test file exists\n- OR task is being marked complete\n- OR both test and implementation files exist\n\n**STEP 1: Determine Validation Scope**\n\nBased on TDD phase and file type:\n\n**A) RED PHASE - Test file created, no implementation yet:**\n- Run TypeScript check: `pnpm run typecheck` (on test file only)\n- Run lint check: `pnpm run lint` (on test file only)\n- DO NOT run tests (they're expected to fail - no implementation)\n- Acknowledge: \"Test file validated (TypeScript + lint clean). Tests not run - awaiting implementation (TDD RED phase).\"\n- Continue to implementation\n\n**B) GREEN PHASE - Implementation file modified (test exists):**\n- Run TypeScript check: `pnpm run typecheck`\n- Run lint check: `pnpm run lint`\n- Run tests: `pnpm test` (tests MUST pass now)\n- If any fail: Fix systematically until all pass\n\n**C) If a .ts or .tsx file was modified (not a test file):**\n- Run TypeScript check: `pnpm run typecheck`\n- If errors found: Fix them immediately\n- If zero errors: Continue\n\n**D) If a .ts, .tsx, .js, .jsx, .css, or other Biome-supported file was modified:**\n- Run lint check: `pnpm run lint`\n- If errors found: Fix them immediately\n- If zero errors: Continue\n\n**E) If a main task (with subtasks) was just marked complete:**\n- Run FULL validation: `pnpm run validate` (typecheck + lint + test)\n- This ensures all tests pass before moving to next task\n- Tests MUST pass (GREEN phase)\n\n**F) If all tasks in a phase are complete:**\n- Run FULL validation: `pnpm run validate`\n- This ensures phase completion meets all quality gates\n- Tests MUST pass (GREEN phase)\n\n**G) If a .md, .json, .yaml, or other non-code file was modified:**\n- No validation needed (these don't affect code quality)\n- Continue with spec work\n\n**STEP 2: Fix Errors Systematically (if any found)**\n- Fix TypeScript errors first (if typecheck ran)\n- Then fix lint errors (if lint ran)\n- Then fix test failures (if tests ran in GREEN phase)\n- After each fix, re-run the same validation command\n- Continue until zero errors\n\n**STEP 3: Verify Zero Errors**\n- When validation shows zero errors, validation is complete\n- Only then continue with next task or spec work\n\n**CRITICAL RULES:**\n- NEVER skip validation for code files\n- NEVER continue to next task with errors present\n- NEVER fix errors without re-running validation\n- In RED phase: Skip tests (they're supposed to fail)\n- In GREEN phase: Tests MUST pass\n- Use targeted checks (typecheck/lint) for file-level changes\n- Use full validation (pnpm run validate) for task/phase completion\n\n**TDD Workflow Examples:**\n\n*Example 1: TDD RED Phase - Created test file*\n```\nCreated: src/types/plugin.test.ts\nCheck: Does src/types/plugin.ts exist? NO\nPhase: RED (tests expected to fail)\nAction: Run typecheck + lint on test file only\nResult: ✅ TypeScript/lint clean\nNext: Create implementation file\n```\n\n*Example 2: TDD GREEN Phase - Created implementation*\n```\nCreated: src/types/plugin.ts\nCheck: Does src/types/plugin.test.ts exist? YES\nPhase: GREEN (tests must pass)\nAction: Run typecheck + lint + test\nResult: Must be ✅ all pass\n```\n\n*Example 3: Modified implementation file*\n```\nModified: src/store/node-store.ts\nCheck: Does src/store/node-store.test.ts exist? YES\nPhase: GREEN (tests must pass)\nAction: Run typecheck + lint + test\nResult: Must be ✅ all pass\n```\n\n*Example 4: Modified CSS file*\n→ Run `pnpm run lint` (Biome-supported file)\n→ If passes, continue\n\n*Example 5: Marked Task 3.2 complete*\n→ Run `pnpm run validate` (main task complete)\n→ Must pass all tests (GREEN phase)\n\n*Example 6: Modified spec markdown*\n→ No validation needed (markdown file)\n→ Continue\n\n**If validation passes (zero errors):**\n- Acknowledge and continue with spec work\n\n**If validation fails (any errors):**\n- List all errors by category and file\n- Start fixing systematically\n- Do NOT continue until zero errors"
  }
}